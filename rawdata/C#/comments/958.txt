Retries an action until a given state.