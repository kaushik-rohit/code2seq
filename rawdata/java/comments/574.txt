TODO: use integration to split this up?