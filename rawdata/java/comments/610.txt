Precondition is that {@code buffer != null}.